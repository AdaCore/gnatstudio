<?xml version="1.0" encoding="utf-8"?>

<!--  This file adds support for the gnattest utility. -->

<gnattest>
  <project_attribute package="gnattest"
    name="harness_dir"
    editor_page="GNATTest"
    editor_section="Directories"
    label="Harness Directory"
    description="is used to specify the directory in which to place harness packages and project file for the test driver"
    >
    <string type="directory"/>
  </project_attribute>

  <project_attribute package="gnattest"
    name="separate_stub_root"
    editor_page="GNATTest"
    editor_section="Directories"
    disable_if_not_set="true"
    disable="gnattest.stub_subdir"
    label="Separate Stub Root"
    description="The directory hierarchy of tested sources is recreated in this directory, and test packages are placed in corresponding directories. "
    />

  <project_attribute package="gnattest"
    name="stub_subdir"
    editor_page="GNATTest"
    editor_section="Directories"
    disable_if_not_set="true"
    disable="gnattest.separate_stub_root"
    label="Stub Subdir"
    description="Test packages are placed in subdirectories"
    >
    <string default="tests"/>
  </project_attribute>

  <project_attribute package="gnattest"
    name="additional_tests"
    editor_page="GNATTest"
    label="Additional Tests"
    description="Sources described in given project are considered potential additional manual tests to be added to the test suite."
    >
    <string type="file" filter="project"/>
  </project_attribute>

  <project_attribute package="gnattest"
    name="stubs_default"
    editor_page="GNATTest"
    label="Stubs Default"
    description="Default behavior of generated stubs."
    >
    <choice default="true">fail</choice>
    <choice>pass</choice>
  </project_attribute>

  <project_attribute package="gnattest"
    name="gnattest_switches"
    editor_page="GNATTest"
    list="true"
    label="GNATtest Switches"
    description="Custom switches for gnattest."
    >
    <string default=""/>
  </project_attribute>

  <project_attribute package="gnattest"
    name="gnattest_mapping_file"
    hide_in="all"
    editor_page="GNATTest"
    label="GNATTest Mapping File"
    description="Map tests to subprograms."
    />

  <action  name="run gnattest">
    <filter id="Non harness project"/>
    <description>Run gnattest on current project file</description>
    <external>gnattest -P%pp</external>
  </action>

  <action name="open harness" output="none">
    <filter id="Harness project exists"/>
    <description>Open harness project for current project</description>
    <shell>Project %p</shell>
    <shell>Project.file %1</shell>
    <shell>File.directory %1</shell>
    <shell>cd %1</shell>
    <shell>Project %p</shell>
    <shell>Project.get_attribute_as_string %1 Harness_Dir GNATtest</shell>
    <shell>cd %1</shell>
    <shell>Project.load test_driver.gpr</shell>
  </action>

  <submenu>
    <title>Tools/GNATTest</title>
    <menu action="run gnattest">
      <title>Run gnattest</title>
    </menu>
    <menu action="open harness">
      <title>Open harness project</title>
    </menu>
  </submenu>

  <contextual action="run gnattest">
    <title>GNATTest/Run gnattest for %p</title>
  </contextual>

  <contextual action="open harness">
    <title>GNATTest/Open harness project for %p</title>
  </contextual>

</gnattest>
