CP              = cp -p
MKDIR           = mkdir -p
RMDIR           = rmdir
STRIP           = strip
INSTALL         = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA    = @INSTALL_DATA@
prefix          = @prefix@
bindir          = $(prefix)/bin
sharedir        = $(prefix)/share
examplesdir     = $(prefix)/share/examples/gps

export TP_TASKING = No_Tasking

default build compile link ada c c++:
	$(MAKE) -s -C gps -f Makefile.gps $@

clean:
	$(RM) gnat/*.ad*
	$(RM) obj/*.ali obj/*.o
	$(MAKE) -s -C gps -f Makefile.gps $@

test-clean:
	(cd scripts; ./testsuites clean)

install-common:
	$(MKDIR) $(bindir)
	$(MKDIR) $(sharedir)
	$(MKDIR) $(examplesdir)
	$(MKDIR) $(sharedir)/gps
	$(MKDIR) $(sharedir)/gps/docgen
	$(MKDIR) $(sharedir)/gps/aunit
	(cd share; tar cf - plug-ins/*.xml) | (cd $(sharedir)/gps; tar xf -)
	(cd share; tar cf - plug-ins/*.py) | (cd $(sharedir)/gps; tar xf -)
	(cd share; tar cf - library/*.xml) | (cd $(sharedir)/gps; tar xf -)
	(cd share; tar cf - library/*.py) | (cd $(sharedir)/gps; tar xf -)
	$(RM) $(sharedir)/gps/python/GPS_old.py
	$(RM) $(sharedir)/gps/plug-ins/emacs.xml
	-$(RMDIR) $(sharedir)/gps/python/
	(cd share; tar cf - icons/)  | (cd $(sharedir)/gps; tar xf -)
	(cd share; tar cf - *.*)  | (cd $(sharedir)/gps; tar xf -)
	(cd docgen/templates; tar cf - html/) \
		| (cd $(sharedir)/gps/docgen; tar xf -)
	(cd aunit/templates; tar cf - *.tmpl) \
		| (cd $(sharedir)/gps/aunit; tar xf -)
	$(MAKE) -C docs install
	(cd examples; tar cf - --exclude CVS . ) | (cd $(examplesdir); tar xf -)

install: install-common
ifeq ($(OS),Windows_NT)
	$(INSTALL_PROGRAM) gps/obj/gps $(bindir)
	$(MAKE) -C common/expect install
else
	$(INSTALL_PROGRAM) gps/obj/gps $(bindir)/gps_exe
	$(INSTALL_PROGRAM) distrib/.gps_wrapper $(bindir)/gps
endif
	$(MAKE) -C kernel/src_info/sn/snsrc install

install-strip: install-common
ifeq ($(OS),Windows_NT)
	$(INSTALL_PROGRAM) -s gps/obj/gps $(bindir)
	$(MAKE) -C common/expect install-strip
else
	$(INSTALL_PROGRAM) -s gps/obj/gps $(bindir)/gps_exe
	$(INSTALL_PROGRAM) distrib/.gps_wrapper $(bindir)/gps
endif
	$(MAKE) -C kernel/src_info/sn/snsrc install-strip

test: force
	@cd scripts; ./testsuites

.PHONY: install install-common install-strip test force

force:
