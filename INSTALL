Building GNAT Studio TUI from sources
=====================================

GNAT Studio TUI (Terminal User Interface) - Branch: strip-down

This is a headless, TUI-focused rewrite of GNAT Studio.
NO GUI (GTK), NO Python - Pure Ada terminal editor.

Prerequisites
=============

## Required

1. **Alire Package Manager**

   Install from: https://alire.ada.dev

   ```bash
   # Verify installation
   alr --version
   ```

2. **System Tools (macOS via Homebrew)**

   ```bash
   brew install autoconf pkg-config
   ```

3. **macOS SDK Compatibility Fix**

   For GNAT toolchain compatibility:
   ```bash
   sudo ln -s MacOSX15.5.sdk /Library/Developer/CommandLineTools/SDKs/MacOSX14.sdk
   ```

4. **CRITICAL: Fix GNAT Toolchain Headers (macOS 26)**

   **REQUIRED for macOS 26 (Darwin 25.0.0):**

   The Alire GNAT 15.1.2 toolchain has broken include-fixed headers
   that prevent C code compilation. Run the fix script:

   ```bash
   ./fix_toolchain.sh
   ```

   This removes broken headers and allows GCC to use correct system headers.

   **⚠️  IMPORTANT:** This fix is TEMPORARY
   - Stored in ~/.local/share/alire/toolchains/ (outside git)
   - Will be lost if Alire reinstalls the toolchain
   - Must be re-applied after toolchain updates
   - Required for all developers on macOS 26

   Without this fix, you'll see errors like:
   ```
   error: unknown type name 'FILE'
   note: 'FILE' is defined in header '<stdio.h>'
   ```

   See `fix_toolchain.sh` for technical details.

Building
========

## Quick Build

```bash
# From repository root
alr build
```

Build time: ~5 seconds (clean), <1 second (incremental)

## Run Test Program

```bash
./test_headless/bin/test_pure_ada
```

Expected output:
```
=== Pure Ada Headless Test ===

VSS.Strings:       OK - Length = 24

✓ Pure Ada compilation successful!
✓ No C dependencies - fully headless!
✓ GNAT 15.1.2 from Alire works!
✓ VSS (Virtual String Subsystem) works!
```

## Clean Build

```bash
alr clean
alr build
```

Dependencies
============

All Ada dependencies are managed by Alire (no manual setup needed):

- gnatcoll 25.0        - GNAT Components Collection (core utilities)
- vss 25.0             - Virtual String Subsystem (text handling)
- xmlada 25.0          - XML/Ada toolkit (for GPR parsing)
- libgpr 25.0          - GNAT Project File library
- gnat 15.1.2          - GNAT compiler (Alire toolchain)

See `DEPENDENCIES.md` for complete dependency information.

Configuration
=============

No configuration needed! Alire automatically:
- Fetches and builds dependencies
- Sets up GPR_PROJECT_PATH
- Configures build environment
- Selects appropriate compiler

Build Modes
===========

```bash
# Debug (default)
alr build

# Production (optimized)
alr build -- -XBUILD=Production

# Parallel build
alr build -- -j8

# Verbose output
alr build -- -v
```

Troubleshooting
===============

## Build fails with "C compiler cannot create executables"

This is expected - the Alire GNAT toolchain has known issues with C compilation on macOS 26.

**Solution:** We avoid C dependencies. The current build uses pure Ada libraries only.

## Missing dependencies

```bash
# Update Alire index
alr update

# Verify dependencies
alr show --solve
```

## GPR file not found errors

The old configure/make system is deprecated for TUI builds.
Always use: `alr build`

Advanced
========

## Alternative Build Methods

### Direct gprbuild (not recommended)

```bash
# Must set environment manually
alr exec -- gprbuild -P test_headless/test_pure_ada.gpr
```

### Old configure/make (DEPRECATED for TUI)

The traditional ./configure && make workflow is deprecated for TUI development.
It still exists for historical reasons but should not be used.

Use `alr build` instead.

Development
===========

## Workflow

```bash
# 1. Make code changes
vim some_file.adb

# 2. Build (incremental, fast)
alr build

# 3. Test
./test_headless/bin/test_pure_ada

# 4. Commit
git add .
git commit -m "description"
```

## Adding Dependencies

Edit `alire.toml` and add:
```toml
[[depends-on]]
package_name = "~version"
```

Then run: `alr update`

## Project Structure

Current build target: `test_headless/test_pure_ada.gpr`

For TUI development, will switch to: `tui/tui.gpr`

Documentation
=============

- `BUILD_INSTRUCTIONS.md` - Detailed build guide
- `DEPENDENCIES.md` - Dependency information
- `MODULES.md` - Module organization
- `PLAN.md` - TUI conversion roadmap
- `CLAUDE.md` - AI assistant guidance

Status & Roadmap
================

**Current Phase:** 1 Complete, 2 Starting

Phase 1 (COMPLETE): Compile headless, strip GTK/Python
Phase 2 (NEXT): TUI bootstrap - init ncurses, draw buffer
Phase 3: Editing basics - insert/delete, undo/redo
Phase 4: Splits & panels
Phase 5: LSP integration - Ada Language Server
Phase 6: Project/build support
Phase 7-10: Search, multi-cursor, polish, debugging

See `PLAN.md` for detailed roadmap.

Support
=======

This is a development branch (strip-down) focused on TUI conversion.

For the original GNAT Studio GUI: See master branch
For TUI development: See PLAN.md and commit history

Repository: https://github.com/AdaCore/gnatstudio
Fork: https://github.com/berkeleynerd/gnatstudio (strip-down branch)
